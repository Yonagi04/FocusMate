<template>
  <div class="pomodoro-timer">
    <h2>
      <template v-if="!started">欢迎使用番茄钟，请点击“开始”专注工作吧！</template>
      <template v-else>{{ isWork ? '工作中，请专心工作哦~' : '休息中，放松一下吧~' }}</template>
    </h2>
    <h3>
      <template v-if="!started"></template>
      <template v-else>第 {{ round }} 轮 {{ isWork ? '工作' : '休息' }}</template>
    </h3>
    <div class="timer">{{ minutes }}:{{ seconds }}</div>
    <div class="actions">
      <button @click="startTimer" :disabled="running">开始</button>
      <button @click="pauseTimer" :disabled="!running">暂停</button>
      <button @click="resetTimer">重置</button>
    </div>
    <div class="bottom-btns">
      <div class="settings-btn" @click="showSettings = true" title="设置">
        <svg v-if="!isLight" t="1754227355950" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21685" width="32" height="32"><path d="M878.08 466.944l-129.3824-253.0816a98.8672 98.8672 0 0 0-88.064-53.8624H366.08c-36.864 0-70.656 20.48-87.6544 53.1456l-132.096 253.0816a98.8672 98.8672 0 0 0 0 91.5456l132.096 253.0816a98.8672 98.8672 0 0 0 87.6544 53.1456h294.5536c37.1712 0 71.168-20.7872 88.064-53.8624l129.3824-253.1328a98.8672 98.8672 0 0 0 0-90.0096z m-72.3968 372.3264a162.8672 162.8672 0 0 1-145.0496 88.7296H366.08a162.8672 162.8672 0 0 1-144.384-87.552l-132.096-253.0816a162.8672 162.8672 0 0 1 0-150.7328l132.096-253.1328a162.8672 162.8672 0 0 1 144.384-87.5008h294.5536c61.184 0 117.1968 34.304 145.0496 88.7296l129.3824 253.1328c23.808 46.592 23.808 101.7344 0 148.2752l-129.3824 253.1328z" fill="#bfbfbf" p-id="21686"></path><path d="M512 697.6a185.6 185.6 0 1 1 0-371.2 185.6 185.6 0 0 1 0 371.2z m0-64a121.6 121.6 0 1 0 0-243.2 121.6 121.6 0 0 0 0 243.2z" fill="#bfbfbf" p-id="21687"></path></svg>
        <svg v-else t="1754227355950" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21685" width="32" height="32"><path d="M878.08 466.944l-129.3824-253.0816a98.8672 98.8672 0 0 0-88.064-53.8624H366.08c-36.864 0-70.656 20.48-87.6544 53.1456l-132.096 253.0816a98.8672 98.8672 0 0 0 0 91.5456l132.096 253.0816a98.8672 98.8672 0 0 0 87.6544 53.1456h294.5536c37.1712 0 71.168-20.7872 88.064-53.8624l129.3824-253.1328a98.8672 98.8672 0 0 0 0-90.0096z m-72.3968 372.3264a162.8672 162.8672 0 0 1-145.0496 88.7296H366.08a162.8672 162.8672 0 0 1-144.384-87.552l-132.096-253.0816a162.8672 162.8672 0 0 1 0-150.7328l132.096-253.1328a162.8672 162.8672 0 0 1 144.384-87.5008h294.5536c61.184 0 117.1968 34.304 145.0496 88.7296l129.3824 253.1328c23.808 46.592 23.808 101.7344 0 148.2752l-129.3824 253.1328z" fill="#515151" p-id="21686"></path><path d="M512 697.6a185.6 185.6 0 1 1 0-371.2 185.6 185.6 0 0 1 0 371.2z m0-64a121.6 121.6 0 1 0 0-243.2 121.6 121.6 0 0 0 0 243.2z" fill="#515151" p-id="21687"></path></svg>
      </div>
      <div class="theme-btn" @click="toggleTheme" :title="isLight ? '切换为夜间模式' : '切换为白昼模式'">
        <svg v-if="!isLight" t="1754227260145" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20390" width="32" height="32"><path d="M512.000213 733.353497c-122.06857 0-221.353283-99.284713-221.353283-221.353284S389.931643 290.64693 512.000213 290.64693 733.353497 389.931643 733.353497 512.000213 634.026117 733.353497 512.000213 733.353497z m0-357.373767A136.148482 136.148482 0 0 0 375.97973 512.000213 136.148482 136.148482 0 0 0 512.000213 648.020697 136.148482 136.148482 0 0 0 648.020697 512.000213 136.148482 136.148482 0 0 0 512.000213 375.97973zM554.666613 171.735673A42.154403 42.154403 0 0 1 512.000213 213.335413c-23.551853 0-42.6664-18.645217-42.6664-41.59974V41.603153A42.154403 42.154403 0 0 1 512.000213 0.003413c23.551853 0 42.6664 18.645217 42.6664 41.59974v130.13252zM554.666613 982.397273A42.154403 42.154403 0 0 1 512.000213 1023.997013c-23.594519 0-42.6664-18.687883-42.6664-41.59974v-130.175186A42.111737 42.111737 0 0 1 512.000213 810.665013c23.551853 0 42.6664 18.60255 42.6664 41.59974v130.13252zM171.735673 469.333813c22.954523 0 41.59974 19.114547 41.59974 42.6664 0 23.594519-18.645217 42.6664-41.59974 42.6664H41.603153A42.154403 42.154403 0 0 1 0.003413 512.000213c0-23.551853 18.645217-42.6664 41.59974-42.6664h130.13252zM982.397273 469.333813c22.954523 0 41.59974 19.114547 41.59974 42.6664 0 23.594519-18.687883 42.6664-41.59974 42.6664h-130.175186A42.111737 42.111737 0 0 1 810.665013 512.000213c0-23.551853 18.60255-42.6664 41.59974-42.6664h130.13252zM241.239239 722.430898a42.06907 42.06907 0 0 1 59.562294 0.767995 42.111737 42.111737 0 0 1 0.767996 59.562295l-92.031425 92.074091a42.154403 42.154403 0 0 1-59.562295-0.853328 42.154403 42.154403 0 0 1-0.767995-59.562294l92.031425-91.988759zM814.462323 149.207814a42.154403 42.154403 0 0 1 59.562294 0.767995 42.154403 42.154403 0 0 1 0.767996 59.562295l-92.031425 92.031425a42.06907 42.06907 0 0 1-59.562295-0.767996 42.111737 42.111737 0 0 1-0.810661-59.562294l92.074091-92.031425zM241.239239 301.526862a42.19707 42.19707 0 0 0 59.604961-0.725329 42.111737 42.111737 0 0 0 0.767995-59.562294L209.538104 149.122481a42.154403 42.154403 0 0 0-59.562295 0.853328 42.111737 42.111737 0 0 0-0.767995 59.562295l92.031425 91.988758zM814.462323 874.792613a42.111737 42.111737 0 0 0 59.562294-0.810662 42.154403 42.154403 0 0 0 0.767996-59.562294l-92.031425-92.031425a42.06907 42.06907 0 0 0-59.562295 0.767995 42.111737 42.111737 0 0 0-0.810661 59.562294l92.074091 92.074092z" fill="#bfbfbf" p-id="20391"></path></svg>
        <svg v-else t="1754227621834" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="22954" width="34" height="34"><path d="M439.04383639 224.33271976a289.43717504 289.43717504 0 0 0-89.06329676 39.44690807c-27.5075319 18.12412161-51.158867 39.64960558-70.96389486 64.57645191-19.79019562 24.92684633-35.31880082 53.25011237-46.62042137 84.97474006C221.10449032 445.05050411 215.45368042 478.01109252 215.45368042 512c0 40.16870887 7.81621301 78.48347702 23.45358166 115.04318192 15.64725682 36.67341315 36.77228986 68.19039996 63.2910532 94.76354538 26.53359488 26.56820206 58.11485196 47.57952611 94.69927585 63.23667111 36.59431134 15.65714501 75.00301286 23.48324474 115.16183354 23.48324475 33.97407594 0 66.85061917-5.56182137 98.62468557-16.89310498 31.76417894-11.32633953 60.10227581-26.77584294 85.01429133-46.65502781 24.87740834-19.77536407 46.43255539-43.46625042 64.57150781-70.96389488a290.15403174 290.15403174 0 0 0 39.43701989-88.98913905c-8.3056532 0.72180079-17.71378249 1.13213991-28.0958481 1.1321392-45.21637032 0-88.35138342-8.85936294-129.45942212-26.46932463-41.1327577-17.71872658-76.62459295-41.50848964-106.44089858-71.27535655C505.84007277 458.54719011 482.10963587 423.01086095 464.42057238 381.91765379 446.7562286 340.81455917 437.94135957 297.65977044 437.94135957 252.4483442c0-10.40184195 0.39550758-19.77536407 1.15685891-28.01674772l-0.049438-0.09887672zM512.02976157 141.21192041c8.32542811 0 16.51242896 0.31146168 24.6054972 0.92944167-16.4036648 35.32374419-24.60549719 72.09603405-24.60549719 110.30698212 0 35.12104668 6.84227598 68.69961578 20.58121076 100.83458258 13.70927096 32.03114601 32.15474243 59.63261126 55.35124448 82.80933769 23.16683898 23.17178306 50.76830423 41.60736635 82.82416923 55.30674985 32.02125855 13.69938351 65.654209 20.60098567 100.78514387 20.60098568 38.23072298 0 75.03267594-8.24138293 110.35147675-24.62032874 0.59326099 8.14250622 0.86517214 16.28006837 0.86517213 24.62032874 0 33.57856837-4.43956893 66.43533597-13.29893256 98.46648269-8.90880166 32.03114601-21.28817928 61.69419283-37.24195443 88.78149743-15.92411206 27.19112615-35.31880082 52.11797247-58.09013296 74.87941716-22.77627549 22.76144395-47.74267309 42.12152555-74.87447306 58.09013223-27.15157487 15.96366261-56.75529553 28.32326532-88.78644152 37.28644905A368.16784419 368.16784419 0 0 1 512.00009921 882.78807959a368.20739474 368.20739474 0 0 1-98.48625832-13.28904439c-32.03609009-8.95824037-61.6249792-21.31784236-88.79138561-37.28150569-27.12685589-15.96860669-52.08336529-35.32868827-74.89919206-58.09013223-22.7515565-22.76144395-42.13635709-47.68829101-58.05058169-74.87941715-15.96366261-27.0922487-28.34304097-56.75529553-37.2518426-88.78149744A367.9354836 367.9354836 0 0 1 141.21201889 512c0-33.57856837 4.4494571-66.43533597 13.30882004-98.46648269 8.90880166-32.03114601 21.28817928-61.69419283 37.25184259-88.78149744 15.91916798-27.19112615 35.29902519-52.11797247 58.0505817-74.87941715 22.81582676-22.86526476 47.77233617-42.22534634 74.89919206-58.09013223C351.89380578 175.81880789 381.4826949 163.36032846 413.51878498 154.50096479A368.20739474 368.20739474 0 0 1 512.00009921 141.21192041h0.02966236z" p-id="22955" fill="#515151"></path></svg>
      </div>
    </div>
    <div class = "white-noise-btn" @click="showWhiteNoise = true" title="白噪音列表">
      <svg v-if="!isLight" t="1754709424697" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2538" width="35" height="35"><path d="M419.037 287.953h413.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H419.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM419.028 543.17h411.608c17.673 0 32-14.327 32-32s-14.327-32-32-32H419.028c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 735.802H419.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h413.124c17.673 0 32-14.327 32-32s-14.327-32-32-32z" fill="#bfbfbf" p-id="2539"></path><path d="M256.037 255.953m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#bfbfbf" p-id="2540"></path><path d="M256.037 510.787m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#bfbfbf" p-id="2541"></path><path d="M256.037 767.621m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#bfbfbf" p-id="2542"></path></svg>
      <svg v-else t="1754709424697" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2538" width="35" height="35"><path d="M419.037 287.953h413.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H419.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM419.028 543.17h411.608c17.673 0 32-14.327 32-32s-14.327-32-32-32H419.028c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 735.802H419.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h413.124c17.673 0 32-14.327 32-32s-14.327-32-32-32z" fill="#515151" p-id="2539"></path><path d="M256.037 255.953m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#515151" p-id="2540"></path><path d="M256.037 510.787m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#515151" p-id="2541"></path><path d="M256.037 767.621m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#515151" p-id="2542"></path></svg>
    </div>
    <transition name="menu-fade">
      <div v-if="showSettings" class="settings-modal">
        <div class="settings-content">
          <h3>番茄钟设置</h3>
          <div class="setting-item">
            <label>工作时长(分钟)：</label>
            <input type="number" min="1" v-model.number="workInput" />
          </div>
          <div class="setting-item">
            <label>休息时长(分钟)：</label>
            <input type="number" min="1" v-model.number="breakInput" />
          </div>
          <div class="setting-item">
            <label>长休息时长(分钟)：</label>
            <input type="number" min="1" v-model.number="longBreakInput" />
          </div>
          <div class="setting-item">
            <label>长休息轮数：</label>
            <input type="number" min="1" v-model.number="longBreakRoundInput" />
          </div>
          <div class="settings-actions">
            <button @click="applySettings">确定</button>
            <button @click="cancelSettings">取消</button>
          </div>
        </div>
      </div>
    </transition>
    <transition name="menu-fade">
      <div v-if="showWhiteNoise" class="white-noise-modal">
        <div class="white-noise-content">
          <h3>白噪声播放</h3>
          <div class="white-noise-list">
            <div
              v-for="sound in sounds"
              :key="sound.key"
              class="white-noise-card"
              :class="{ playing: playingList[sound.key] }"
              @click="toggleSound(sound.key)"
            >
              <!-- <button class="favorite-btn" title="收藏">
                <span aria-hidden="true">
                  <svg width="10" height="10" viewBox="0 0 24 24"><path d="M12 4.595a5.904 5.904 0 0 0-3.996-1.558 5.942 5.942 0 0 0-4.213 1.758c-2.353 2.363-2.352 6.059.002 8.412l7.332 7.332c.17.299.498.492.875.492a.99.99 0 0 0 .792-.409l7.415-7.415c2.354-2.354 2.354-6.049-.002-8.416a5.938 5.938 0 0 0-4.209-1.754A5.906 5.906 0 0 0 12 4.595zm6.791 1.61c1.563 1.571 1.564 4.025.002 5.588L12 18.586l-6.793-6.793c-1.562-1.563-1.561-4.017-.002-5.584.76-.756 1.754-1.172 2.799-1.172s2.035.416 2.789 1.17l.5.5a.999.999 0 0 0 1.414 0l.5-.5c1.512-1.509 4.074-1.505 5.584-.002z"></path></svg>
                </span>
              </button> -->
              <div class="icon" v-html="isLight ? soundIcons[sound.key].light : soundIcons[sound.key].dark"></div>
              <div class="label">{{ sound.label }}</div>
              <input
                type="range"
                min="0"
                max="100"
                :value="volumes[sound.key]"
                @input.stop="setVolume(sound.key, $event.target.value)"
                @click.stop
                :disabled="!playingList[sound.key]"
                aria-label="音量"
              />
            </div>
          </div>
          <div class="white-noise-actions">
            <button @click="closeWhiteNoise">关闭</button>
          </div>
        </div>
      </div>
    </transition>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'

async function getSetting(key, def) {
  if (window.settingsAPI) {
    const val = await window.settingsAPI.get(key)
    return typeof val === 'number' && !isNaN(val) ? val : def
  }
  return def 
}

function setSetting(key, value) {
  if (!window.settingsAPI) return
  window.settingsAPI.set(key, value)
}

const Store = window.require ? window.require('electron-store') : null
const store = Store ? new Store({ name: 'pomodoro-settings' }) : null

const DEFAULT_WORK = 25 // 默认工作时长 25分钟
const DEFAULT_BREAK = 5 // 默认休息时长 5分钟
const DEFAULT_LONG_BREAK = 15 // 默认长休息时长 15分钟
const DEFAULT_LONG_BREAK_ROUND = 4 // 默认长休息轮数 4轮

const WORK_DURATION = ref(DEFAULT_WORK * 60)
const BREAK_DURATION = ref(DEFAULT_BREAK * 60)
const LONG_BREAK_DURATION = ref(DEFAULT_LONG_BREAK * 60)
const LONG_BREAK_ROUND = ref(DEFAULT_LONG_BREAK_ROUND)

const isWork = ref(true)
const timeLeft = ref(WORK_DURATION.value)
const running = ref(false)
const started = ref(false)
const round = ref(1)
let timer = null

const showSettings = ref(false)
const workInput = ref(getSetting('work', DEFAULT_WORK))
const breakInput = ref(getSetting('break', DEFAULT_BREAK))
const longBreakInput = ref(getSetting('longBreak', DEFAULT_LONG_BREAK))
const longBreakRoundInput = ref(getSetting('longBreakRound', DEFAULT_LONG_BREAK_ROUND))

const minutes = computed(() => String(Math.floor(timeLeft.value / 60)).padStart(2, '0'))
const seconds = computed(() => String(timeLeft.value % 60).padStart(2, '0'))

const isLight = ref(false)
const showWhiteNoise = ref(false)

const sounds = [
  { key: 'cafe', label: '咖啡馆', src: new URL('../assets/sounds/cafe.mp3', import.meta.url).href },
  { key: 'rain', label: '雨声', src: new URL('../assets/sounds/heavy-rain.mp3', import.meta.url).href },
  { key: 'waves', label: '海浪', src: new URL('../assets/sounds/waves.mp3', import.meta.url).href },
  { key: 'fire', label: '营火', src: new URL('../assets/sounds/campfire.mp3', import.meta.url).href }
]

const soundIcons = {
  cafe: {
    dark: `<svg t="1754714720737" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8930" width="32" height="32"><path d="M517.333333 789.333333h-96l-4.693333-2.56A384 384 0 0 1 213.333333 448v-21.333333h512v21.333333a384 384 0 0 1-203.306666 338.773333z m-85.333333-42.666666h74.666667A341.333333 341.333333 0 0 0 682.666667 469.333333H256a341.333333 341.333333 0 0 0 176 277.333334zM481.066667 424.32A99.84 99.84 0 0 1 426.666667 341.333333a135.253333 135.253333 0 0 1 36.266666-76.8A111.146667 111.146667 0 0 0 490.666667 213.333333a123.52 123.52 0 0 0-36.48-70.186666l30.293333-30.293334C489.386667 117.973333 533.333333 163.2 533.333333 213.333333a135.253333 135.253333 0 0 1-36.266666 76.8A111.146667 111.146667 0 0 0 469.333333 341.333333a58.666667 58.666667 0 0 0 30.933334 45.013334zM609.066667 424.32A99.84 99.84 0 0 1 554.666667 341.333333a98.986667 98.986667 0 0 1 38.186666-68.48c13.226667-13.226667 25.813333-25.6 25.813334-38.186666a58.666667 58.666667 0 0 0-30.933334-45.013334l19.2-37.973333A99.84 99.84 0 0 1 661.333333 234.666667a98.986667 98.986667 0 0 1-38.186666 68.48c-13.226667 13.226667-25.813333 25.6-25.813334 38.186666a58.666667 58.666667 0 0 0 30.933334 45.013334zM353.066667 424.32A99.84 99.84 0 0 1 298.666667 341.333333a98.986667 98.986667 0 0 1 38.186666-68.48c13.226667-13.226667 25.813333-25.6 25.813334-38.186666a58.666667 58.666667 0 0 0-30.933334-45.013334l19.2-37.973333A99.84 99.84 0 0 1 405.333333 234.666667a98.986667 98.986667 0 0 1-38.186666 68.48c-13.226667 13.226667-25.813333 25.6-25.813334 38.186666a58.666667 58.666667 0 0 0 30.933334 45.013334z" p-id="8931" fill="#cdcdcd"></path><path d="M712.746667 553.386667C729.173333 535.04 749.653333 512 768 512a39.253333 39.253333 0 0 1 42.666667 42.666667 34.773333 34.773333 0 0 1-2.346667 10.453333l37.12 21.333333A83.413333 83.413333 0 0 0 853.333333 554.666667a80.853333 80.853333 0 0 0-85.333333-85.333334c-37.546667 0-66.133333 32.213333-87.04 55.68-4.906667 5.333333-9.173333 10.453333-13.44 14.506667l30.293333 30.293333c4.693333-4.693333 9.6-10.453333 14.933334-16.426666zM784.213333 600.533333a112 112 0 0 1-15.146666 12.373334 101.76 101.76 0 0 1-99.84 7.253333l-15.786667 39.68a164.48 164.48 0 0 0 61.44 12.373333 139.733333 139.733333 0 0 0 78.293333-23.893333 154.24 154.24 0 0 0 28.8-26.026667z" p-id="8932" fill="#cdcdcd"></path></svg>`,
    light: `<svg t="1754714720737" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8930" width="32" height="32"><path d="M517.333333 789.333333h-96l-4.693333-2.56A384 384 0 0 1 213.333333 448v-21.333333h512v21.333333a384 384 0 0 1-203.306666 338.773333z m-85.333333-42.666666h74.666667A341.333333 341.333333 0 0 0 682.666667 469.333333H256a341.333333 341.333333 0 0 0 176 277.333334zM481.066667 424.32A99.84 99.84 0 0 1 426.666667 341.333333a135.253333 135.253333 0 0 1 36.266666-76.8A111.146667 111.146667 0 0 0 490.666667 213.333333a123.52 123.52 0 0 0-36.48-70.186666l30.293333-30.293334C489.386667 117.973333 533.333333 163.2 533.333333 213.333333a135.253333 135.253333 0 0 1-36.266666 76.8A111.146667 111.146667 0 0 0 469.333333 341.333333a58.666667 58.666667 0 0 0 30.933334 45.013334zM609.066667 424.32A99.84 99.84 0 0 1 554.666667 341.333333a98.986667 98.986667 0 0 1 38.186666-68.48c13.226667-13.226667 25.813333-25.6 25.813334-38.186666a58.666667 58.666667 0 0 0-30.933334-45.013334l19.2-37.973333A99.84 99.84 0 0 1 661.333333 234.666667a98.986667 98.986667 0 0 1-38.186666 68.48c-13.226667 13.226667-25.813333 25.6-25.813334 38.186666a58.666667 58.666667 0 0 0 30.933334 45.013334zM353.066667 424.32A99.84 99.84 0 0 1 298.666667 341.333333a98.986667 98.986667 0 0 1 38.186666-68.48c13.226667-13.226667 25.813333-25.6 25.813334-38.186666a58.666667 58.666667 0 0 0-30.933334-45.013334l19.2-37.973333A99.84 99.84 0 0 1 405.333333 234.666667a98.986667 98.986667 0 0 1-38.186666 68.48c-13.226667 13.226667-25.813333 25.6-25.813334 38.186666a58.666667 58.666667 0 0 0 30.933334 45.013334z" p-id="8931" fill="#707070"></path><path d="M712.746667 553.386667C729.173333 535.04 749.653333 512 768 512a39.253333 39.253333 0 0 1 42.666667 42.666667 34.773333 34.773333 0 0 1-2.346667 10.453333l37.12 21.333333A83.413333 83.413333 0 0 0 853.333333 554.666667a80.853333 80.853333 0 0 0-85.333333-85.333334c-37.546667 0-66.133333 32.213333-87.04 55.68-4.906667 5.333333-9.173333 10.453333-13.44 14.506667l30.293333 30.293333c4.693333-4.693333 9.6-10.453333 14.933334-16.426666zM784.213333 600.533333a112 112 0 0 1-15.146666 12.373334 101.76 101.76 0 0 1-99.84 7.253333l-15.786667 39.68a164.48 164.48 0 0 0 61.44 12.373333 139.733333 139.733333 0 0 0 78.293333-23.893333 154.24 154.24 0 0 0 28.8-26.026667z" p-id="8932" fill="#707070"></path></svg>`
  },
  rain: {
    dark: `<svg t="1754714661123" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7412" width="32" height="32"><path d="M913.902486 396.369469c-24.63405-25.14468-56.262398-41.21775-90.583065-46.339398C815.932174 220.757846 708.377576 117.856221 577.230654 117.856221c-95.02626 0-180.608427 54.472636-221.50793 138.26504-18.184151-12.360516-39.795355-19.12457-62.380746-19.12457-61.253062 0-111.087051 49.835012-111.087051 111.090121 0 1.727341 0.039909 3.454682 0.12075 5.179976-68.349691 18.690688-117.686353 81.69872-117.686353 154.208151 0 88.143503 71.773673 159.852708 159.995971 159.852708l104.141872 0 0 269.705652c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967L370.009102 667.327648l188.599426 0 0 269.705652c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967L599.790462 667.327648 800.12721 667.327648c42.039465 0 81.85017-16.546861 112.091938-46.592155 30.453592-30.255071 47.223534-70.342068 47.223534-112.87886C959.442682 465.942011 943.270351 426.347225 913.902486 396.369469zM883.195114 591.521125c-22.476921 22.327518-51.976792 34.625612-83.067904 34.625612L224.684272 626.146737c-65.514109 0-118.814036-53.236482-118.814036-118.671797 0-59.013045 44.00012-109.546975 102.348016-117.545136 5.773494-0.789992 10.94119-3.991917 14.220886-8.809643 3.281743-4.815679 4.367471-10.79588 2.990101-16.458857-1.323135-5.430686-1.992377-11.008728-1.992377-16.575514 0-38.546921 31.358195-69.90921 69.905116-69.90921 21.118993 0 40.889269 9.402137 54.241368 25.794479 4.723581 5.79703 12.213159 8.582469 19.580964 7.267521 7.361665-1.312902 13.431917-6.513344 15.859199-13.58746 28.455075-82.909292 106.500593-138.613988 194.207144-138.613988 113.208365 0 205.311039 92.053556 205.311039 205.203592 0 0.856507 0.020466 1.693572 0.039909 2.523473 0.016373 0.560772 0.037862 1.116427 0.024559 1.689479-0.245593 11.326976 8.707312 20.72502 20.031219 21.028942 31.043017 0.836041 60.109006 13.516852 81.846076 35.706223 21.781072 22.233374 33.777291 51.593052 33.777291 82.667791C918.261771 539.344788 905.809157 569.05546 883.195114 591.521125z" fill="#cdcdcd" p-id="7413"></path><path d="M464.307791 701.314717c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 215.127615c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967L484.898759 721.905684C484.898759 710.533682 475.679793 701.314717 464.307791 701.314717z" fill="#cdcdcd" p-id="7414"></path><path d="M694.087105 701.314717c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 215.127615c0 11.370978 9.219989 20.590967 20.590967 20.590967s20.590967-9.219989 20.590967-20.590967L714.678072 721.905684C714.678072 710.533682 705.458083 701.314717 694.087105 701.314717z" fill="#cdcdcd" p-id="7415"></path><path d="M234.527454 763.086595c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 91.583858c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967l0-91.583858C255.118422 772.305561 245.898433 763.086595 234.527454 763.086595z" fill="#cdcdcd" p-id="7416"></path><path d="M808.978808 763.086595c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 91.583858c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967l0-91.583858C829.568752 772.305561 820.349787 763.086595 808.978808 763.086595z" fill="#cdcdcd" p-id="7417"></path></svg>`,
    light: `<svg t="1754714661123" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7412" width="32" height="32"><path d="M913.902486 396.369469c-24.63405-25.14468-56.262398-41.21775-90.583065-46.339398C815.932174 220.757846 708.377576 117.856221 577.230654 117.856221c-95.02626 0-180.608427 54.472636-221.50793 138.26504-18.184151-12.360516-39.795355-19.12457-62.380746-19.12457-61.253062 0-111.087051 49.835012-111.087051 111.090121 0 1.727341 0.039909 3.454682 0.12075 5.179976-68.349691 18.690688-117.686353 81.69872-117.686353 154.208151 0 88.143503 71.773673 159.852708 159.995971 159.852708l104.141872 0 0 269.705652c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967L370.009102 667.327648l188.599426 0 0 269.705652c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967L599.790462 667.327648 800.12721 667.327648c42.039465 0 81.85017-16.546861 112.091938-46.592155 30.453592-30.255071 47.223534-70.342068 47.223534-112.87886C959.442682 465.942011 943.270351 426.347225 913.902486 396.369469zM883.195114 591.521125c-22.476921 22.327518-51.976792 34.625612-83.067904 34.625612L224.684272 626.146737c-65.514109 0-118.814036-53.236482-118.814036-118.671797 0-59.013045 44.00012-109.546975 102.348016-117.545136 5.773494-0.789992 10.94119-3.991917 14.220886-8.809643 3.281743-4.815679 4.367471-10.79588 2.990101-16.458857-1.323135-5.430686-1.992377-11.008728-1.992377-16.575514 0-38.546921 31.358195-69.90921 69.905116-69.90921 21.118993 0 40.889269 9.402137 54.241368 25.794479 4.723581 5.79703 12.213159 8.582469 19.580964 7.267521 7.361665-1.312902 13.431917-6.513344 15.859199-13.58746 28.455075-82.909292 106.500593-138.613988 194.207144-138.613988 113.208365 0 205.311039 92.053556 205.311039 205.203592 0 0.856507 0.020466 1.693572 0.039909 2.523473 0.016373 0.560772 0.037862 1.116427 0.024559 1.689479-0.245593 11.326976 8.707312 20.72502 20.031219 21.028942 31.043017 0.836041 60.109006 13.516852 81.846076 35.706223 21.781072 22.233374 33.777291 51.593052 33.777291 82.667791C918.261771 539.344788 905.809157 569.05546 883.195114 591.521125z" fill="#707070" p-id="7413"></path><path d="M464.307791 701.314717c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 215.127615c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967L484.898759 721.905684C484.898759 710.533682 475.679793 701.314717 464.307791 701.314717z" fill="#707070" p-id="7414"></path><path d="M694.087105 701.314717c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 215.127615c0 11.370978 9.219989 20.590967 20.590967 20.590967s20.590967-9.219989 20.590967-20.590967L714.678072 721.905684C714.678072 710.533682 705.458083 701.314717 694.087105 701.314717z" fill="#707070" p-id="7415"></path><path d="M234.527454 763.086595c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 91.583858c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967l0-91.583858C255.118422 772.305561 245.898433 763.086595 234.527454 763.086595z" fill="#707070" p-id="7416"></path><path d="M808.978808 763.086595c-11.370978 0-20.590967 9.219989-20.590967 20.590967l0 91.583858c0 11.370978 9.219989 20.590967 20.590967 20.590967 11.370978 0 20.590967-9.219989 20.590967-20.590967l0-91.583858C829.568752 772.305561 820.349787 763.086595 808.978808 763.086595z" fill="#707070" p-id="7417"></path></svg>`
  },
  waves: {
    dark: `<svg t="1754714595314" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6195" width="32" height="32"><path d="M790.8 253.9c-63.3-9.7-149.9-10.3-246.8 25l-15.4 5.9c-120.9 48.4-230.1 48.4-309 36.3-44.9-6.9-89.9-17.4-130.8-37.8-22.1-11.1-31.1-38-20.1-60.1 10.3-20.5 34.1-29.7 55.2-22.1l4.8 2c32.3 15.7 69.3 24 104.5 29.5 63.3 9.7 149.9 10.3 246.8-25l15.4-5.9c120.9-48.4 230.1-48.4 309-36.3 44.2 6.8 90.4 17.7 130.8 37.8 22.1 11.1 31.1 38 20.1 60.1-11 22-38.1 30.7-60 20.1-32.6-15.5-69.1-24.1-104.5-29.5z m0 268.8c-63.3-9.7-149.9-10.3-246.8 25l-15.4 5.9c-120.9 48.4-230.1 48.4-309 36.3-44.9-6.9-89.9-17.4-130.8-37.8-22.1-11.1-31.1-38-20.1-60.1 10.3-20.5 34.1-29.7 55.2-22.2l4.8 2c32.3 15.7 69.3 24 104.5 29.5 63.3 9.7 149.9 10.3 246.8-25l15.4-5.9c120.9-48.4 230.1-48.4 309-36.3 44.2 6.8 90.4 17.7 130.8 37.8 22.1 11.1 31.1 38 20.1 60.1-11 22-38.1 30.7-60 20.1-32.6-15.4-69.1-24-104.5-29.4z m-278.6 306l16.4-6.3c103.1-41.2 195.5-41.2 262.2-30.9 35.4 5.4 71.9 14.1 104.4 29.4 21.9 10.6 49.1 1.9 60-20.1 11.1-22.1 2.1-49.1-20.1-60.1-40.4-20.1-86.6-31-130.8-37.8-75.4-11.6-178.3-12.1-292.6 30l-16.4 6.3c-103.1 41.2-195.5 41.2-262.2 30.9-30.2-4.6-61.7-11.4-90.4-23.2l-14.1-6.3c-22.1-11-48.9-2-60 20.1-11.1 22.1-2.1 49.1 20.1 60.1 40.9 20.4 85.9 30.9 130.8 37.8 75.5 11.7 178.4 12.1 292.7-29.9z" p-id="6196" fill="#cdcdcd"></path></svg>`,
    light: `<svg t="1754714595314" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6195" width="32" height="32"><path d="M790.8 253.9c-63.3-9.7-149.9-10.3-246.8 25l-15.4 5.9c-120.9 48.4-230.1 48.4-309 36.3-44.9-6.9-89.9-17.4-130.8-37.8-22.1-11.1-31.1-38-20.1-60.1 10.3-20.5 34.1-29.7 55.2-22.1l4.8 2c32.3 15.7 69.3 24 104.5 29.5 63.3 9.7 149.9 10.3 246.8-25l15.4-5.9c120.9-48.4 230.1-48.4 309-36.3 44.2 6.8 90.4 17.7 130.8 37.8 22.1 11.1 31.1 38 20.1 60.1-11 22-38.1 30.7-60 20.1-32.6-15.5-69.1-24.1-104.5-29.5z m0 268.8c-63.3-9.7-149.9-10.3-246.8 25l-15.4 5.9c-120.9 48.4-230.1 48.4-309 36.3-44.9-6.9-89.9-17.4-130.8-37.8-22.1-11.1-31.1-38-20.1-60.1 10.3-20.5 34.1-29.7 55.2-22.2l4.8 2c32.3 15.7 69.3 24 104.5 29.5 63.3 9.7 149.9 10.3 246.8-25l15.4-5.9c120.9-48.4 230.1-48.4 309-36.3 44.2 6.8 90.4 17.7 130.8 37.8 22.1 11.1 31.1 38 20.1 60.1-11 22-38.1 30.7-60 20.1-32.6-15.4-69.1-24-104.5-29.4z m-278.6 306l16.4-6.3c103.1-41.2 195.5-41.2 262.2-30.9 35.4 5.4 71.9 14.1 104.4 29.4 21.9 10.6 49.1 1.9 60-20.1 11.1-22.1 2.1-49.1-20.1-60.1-40.4-20.1-86.6-31-130.8-37.8-75.4-11.6-178.3-12.1-292.6 30l-16.4 6.3c-103.1 41.2-195.5 41.2-262.2 30.9-30.2-4.6-61.7-11.4-90.4-23.2l-14.1-6.3c-22.1-11-48.9-2-60 20.1-11.1 22.1-2.1 49.1 20.1 60.1 40.9 20.4 85.9 30.9 130.8 37.8 75.5 11.7 178.4 12.1 292.7-29.9z" p-id="6196" fill="#707070"></path></svg>`
  },
  fire: {
    dark: `<svg t="1754714520481" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4031" width="32" height="32"><path d="M541.86 701.202C540.438 684.84 526.728 672 510 672c-15.27 0-28.02 10.704-31.21 25.012l-0.014-0.004-31.224 185.004C446.546 886.516 446 891.194 446 896c0 35.346 28.654 64 64 64s64-28.654 64-64c0-5.798-0.786-11.41-2.23-16.754L541.86 701.202z" p-id="4032" fill="#cdcdcd"></path><path d="M611.808 710.092 611.806 710.088 611.8 710.092Z" p-id="4033" fill="#cdcdcd"></path><path d="M785.75 780.522c-3.436-2.814-6.6-5.762-10.276-7.88l-127.258-95.014c-11.55-7.592-23.994-7.378-33.054 1.7-8.262 8.286-9.372 20.738-3.356 30.762l97.918 131.526c1.892 2.988 4.332 5.598 6.732 8.39 15.604 18.142 50.16 19.176 69.292-0.014C804.89 830.818 804.61 795.972 785.75 780.522z" p-id="4034" fill="#cdcdcd"></path><path d="M745.022 670.036 745.018 670.036 745.018 670.04Z" p-id="4035" fill="#cdcdcd"></path><path d="M870.856 644.95l-119.042-4.568c-7.782-1.116-14.8 4.106-16.13 12.022-1.208 7.222 2.694 14.276 9.336 17.632l0.026-0.078c0.082 0.038 0.124 0.012 0.21 0.05l115.434 35.512c16.578 3.86 35.312-4.686 35.312-23.296C896 658.656 889.834 647.334 870.856 644.95z" p-id="4036" fill="#cdcdcd"></path><path d="M278.444 670.04 278.444 670.036 278.44 670.036Z" p-id="4037" fill="#cdcdcd"></path><path d="M278.418 669.958l0.026 0.078c6.642-3.358 10.544-10.41 9.336-17.632-1.33-7.916-8.35-13.136-16.13-12.022l-119.042 4.568C133.626 647.334 128 658.656 128 682.222c0 18.612 18.196 27.156 34.774 23.296l115.434-35.512C278.292 669.968 278.336 669.994 278.418 669.958z" p-id="4038" fill="#cdcdcd"></path><path d="M375.806 677.614l-127.194 94.862c-3.676 2.114-7.138 4.724-10.274 7.862-19.126 19.134-19.132 50.176-0.008 69.3 19.122 19.142 50.11 19.156 69.236 0.014 2.6-2.598 4.81-5.388 6.704-8.37L412.194 710c6.014-10 4.904-22.426-3.354-30.692C399.786 670.252 385.424 669.524 375.806 677.614z" p-id="4039" fill="#cdcdcd"></path><path d="M704 256c0-122-144.7-192-192-192 24.034 171.106-203.334 239.334-224 384s96 192 96 192c32.666-119.792 144.772-159.994 219.334-211.334C684.666 372.666 704 320.122 704 256z" p-id="4040" fill="#cdcdcd"></path><path d="M704 512c10.06-31.226 9.82-98 0-128-17.998 37-52.574 68.6-94.372 97.378-17.168 11.822-39.718 22.886-57.66 33.594-37.428 22.33-69.968 43.696-94.658 72.8C480.002 622.5 513.946 640 544 640 615.998 640 672 611.324 704 512z" p-id="4041" fill="#cdcdcd"></path><path d="M304.074 320c23.444-31.904 49.712-50.418 76.38-76.724 26.872-26.508 44.154-44.942 54.928-66.346C414.05 134.268 379.684 123.714 352 128c4.666 60.668-59.94 93.134-64 137.314C285.546 292 293 312 304.074 320z" p-id="4042" fill="#cdcdcd"></path></svg>`,
    light: `<svg t="1754714520481" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4031" width="32" height="32"><path d="M541.86 701.202C540.438 684.84 526.728 672 510 672c-15.27 0-28.02 10.704-31.21 25.012l-0.014-0.004-31.224 185.004C446.546 886.516 446 891.194 446 896c0 35.346 28.654 64 64 64s64-28.654 64-64c0-5.798-0.786-11.41-2.23-16.754L541.86 701.202z" p-id="4032" fill="#707070"></path><path d="M611.808 710.092 611.806 710.088 611.8 710.092Z" p-id="4033" fill="#707070"></path><path d="M785.75 780.522c-3.436-2.814-6.6-5.762-10.276-7.88l-127.258-95.014c-11.55-7.592-23.994-7.378-33.054 1.7-8.262 8.286-9.372 20.738-3.356 30.762l97.918 131.526c1.892 2.988 4.332 5.598 6.732 8.39 15.604 18.142 50.16 19.176 69.292-0.014C804.89 830.818 804.61 795.972 785.75 780.522z" p-id="4034" fill="#707070"></path><path d="M745.022 670.036 745.018 670.036 745.018 670.04Z" p-id="4035" fill="#707070"></path><path d="M870.856 644.95l-119.042-4.568c-7.782-1.116-14.8 4.106-16.13 12.022-1.208 7.222 2.694 14.276 9.336 17.632l0.026-0.078c0.082 0.038 0.124 0.012 0.21 0.05l115.434 35.512c16.578 3.86 35.312-4.686 35.312-23.296C896 658.656 889.834 647.334 870.856 644.95z" p-id="4036" fill="#707070"></path><path d="M278.444 670.04 278.444 670.036 278.44 670.036Z" p-id="4037" fill="#707070"></path><path d="M278.418 669.958l0.026 0.078c6.642-3.358 10.544-10.41 9.336-17.632-1.33-7.916-8.35-13.136-16.13-12.022l-119.042 4.568C133.626 647.334 128 658.656 128 682.222c0 18.612 18.196 27.156 34.774 23.296l115.434-35.512C278.292 669.968 278.336 669.994 278.418 669.958z" p-id="4038" fill="#707070"></path><path d="M375.806 677.614l-127.194 94.862c-3.676 2.114-7.138 4.724-10.274 7.862-19.126 19.134-19.132 50.176-0.008 69.3 19.122 19.142 50.11 19.156 69.236 0.014 2.6-2.598 4.81-5.388 6.704-8.37L412.194 710c6.014-10 4.904-22.426-3.354-30.692C399.786 670.252 385.424 669.524 375.806 677.614z" p-id="4039" fill="#707070"></path><path d="M704 256c0-122-144.7-192-192-192 24.034 171.106-203.334 239.334-224 384s96 192 96 192c32.666-119.792 144.772-159.994 219.334-211.334C684.666 372.666 704 320.122 704 256z" p-id="4040" fill="#707070"></path><path d="M704 512c10.06-31.226 9.82-98 0-128-17.998 37-52.574 68.6-94.372 97.378-17.168 11.822-39.718 22.886-57.66 33.594-37.428 22.33-69.968 43.696-94.658 72.8C480.002 622.5 513.946 640 544 640 615.998 640 672 611.324 704 512z" p-id="4041" fill="#707070"></path><path d="M304.074 320c23.444-31.904 49.712-50.418 76.38-76.724 26.872-26.508 44.154-44.942 54.928-66.346C414.05 134.268 379.684 123.714 352 128c4.666 60.668-59.94 93.134-64 137.314C285.546 292 293 312 304.074 320z" p-id="4042" fill="#707070"></path></svg>`
  }
}

const playingList = ref({})
const volumes = ref({})

const audioMap = {}

sounds.forEach(s => {
  volumes.value[s.key] = 50
  playingList.value[s.key] = false
})

function toggleTheme() {
  isLight.value = !isLight.value
  if (isLight.value) {
    document.body.classList.add('light')
  } else {
    document.body.classList.remove('light')
  }
}

function toggleSound(key) {
  if (!audioMap[key]) {
    audioMap[key] = new Audio(sounds.find(s => s.key === key).src)
    audioMap[key].loop = true
    audioMap[key].volume = volumes.value[key] / 100
  }
  if (playingList.value[key]) {
    audioMap[key].pause()
    playingList.value[key] = false
  } else {
    audioMap[key].volume = volumes.value[key] / 100
    audioMap[key].play()
    playingList.value[key] = true
  }
}

function setVolume(key, val) {
  volumes.value[key] = Number(val)
  if (audioMap[key]) {
    audioMap[key].volume = volumes.value[key] / 100
  }
}

function closeWhiteNoise() {
  // Object.keys(audioMap).forEach(key => {
  //   audioMap[key].pause()
  //   playingList.value[key] = false
  // })
  showWhiteNoise.value = false
}

function showNotification(title, body) {
  if (window.Notification && Notification.permission === 'granted') {
    new Notification(title, { body })
  } else if (window.Notification && Notification.permission !== 'denied') {
    Notification.requestPermission().then(permission => {
      if (permission === 'granted') {
        new Notification(title, { body })
      }
    })
  }
}

function startTimer() {
  if (running.value) return
  running.value = true
  started.value = true
  timer = setInterval(() => {
    if (timeLeft.value > 0) {
      timeLeft.value--
    } else {
      pauseTimer()
      if (isWork.value) {
        showNotification('工作时间结束', '请休息一下，放松一下眼睛和大脑！')
      } else {
        showNotification('休息时间结束', '请继续工作，保持专注！')
      }
      switchMode()
    }
  }, 1000)
}

function pauseTimer() {
  running.value = false
  if (timer) {
    clearInterval(timer)  
    timer = null
  }
}

function resetTimer() {
  if (running.value) {
    // 弹窗提示
    if (confirm('当前计时器正在运行，是否要重置？')) {
      pauseTimer()
    } else {
      return
    }
  }
  pauseTimer()
  if (!isWork.value && round.value % LONG_BREAK_ROUND.value === 0) {
    timeLeft.value = LONG_BREAK_DURATION.value
  } else {
    timeLeft.value = isWork.value ? WORK_DURATION.value : BREAK_DURATION.value
  }
}

function switchMode() {
  isWork.value = !isWork.value
  if (!isWork.value && round.value % LONG_BREAK_ROUND.value === 0) {
    timeLeft.value = LONG_BREAK_DURATION.value
  } else {
    timeLeft.value = isWork.value ? WORK_DURATION.value : BREAK_DURATION.value
  }
  if (isWork.value) {
    round.value++
  }
}

function applySettings() {
  WORK_DURATION.value = Math.max(1, workInput.value) * 60
  BREAK_DURATION.value = Math.max(1, breakInput.value) * 60
  LONG_BREAK_DURATION.value = Math.max(1, longBreakInput.value) * 60
  LONG_BREAK_ROUND.value = Math.max(1, longBreakRoundInput.value)
  setSetting('work', workInput.value)
  setSetting('break', breakInput.value)
  setSetting('longBreak', longBreakInput.value)
  setSetting('longBreakRound', longBreakRoundInput.value)
  console.log('Settings saved:', {
    work: workInput.value,
    break: breakInput.value,
    longBreak: longBreakInput.value,
    longBreakRound: longBreakRoundInput.value
  })
  resetTimer()
  showSettings.value = false
}

function cancelSettings() {
  workInput.value = WORK_DURATION.value / 60
  breakInput.value = BREAK_DURATION.value / 60
  longBreakInput.value = LONG_BREAK_DURATION.value / 60
  longBreakRoundInput.value = LONG_BREAK_ROUND.value
  showSettings.value = false
}

onMounted(async () => {
  workInput.value = await getSetting('work', DEFAULT_WORK)
  breakInput.value = await getSetting('break', DEFAULT_BREAK)
  longBreakInput.value = await getSetting('longBreak', DEFAULT_LONG_BREAK)
  longBreakRoundInput.value = await getSetting('longBreakRound', DEFAULT_LONG_BREAK_ROUND)

  WORK_DURATION.value = workInput.value * 60
  BREAK_DURATION.value = breakInput.value * 60
  LONG_BREAK_DURATION.value = longBreakInput.value * 60
  LONG_BREAK_ROUND.value = longBreakRoundInput.value

  if (!started.value) {
    timeLeft.value = isWork.value ? WORK_DURATION.value : BREAK_DURATION.value
  }
})
</script>

<style scoped>
.pomodoro-timer {
  text-align: center;
  margin: 40px auto;
  padding: 24px 0;
  position: relative;
}
.timer {
  font-size: 3em;
  margin: 20px 0;
  font-family: 'Consolas', 'Menlo', 'Monaco', monospace;
  letter-spacing: 2px;
}
.actions {
  margin-top: 16px;
}
.bottom-btns {
  position: fixed;
  left: 16px;
  bottom: 16px;
  display: flex;
  gap: 12px;
  z-index: 100;
}
.settings-btn,
.theme-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 40px;
  width: 40px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s;
  padding: 0;
  box-sizing: border-box;
}
.white-noise-btn {
  position: fixed;
  right: 16px;
  bottom: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 40px;
  width: 40px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s;
  padding: 0;
  box-sizing: border-box;
  z-index: 101;
}
.settings-btn:hover,
.theme-btn:hover,
.white-noise-btn:hover {
  opacity: 1;
}
.settings-btn .icon,
.theme-btn .icon,
.white-noise-btn .icon,
.settings-btn svg,
.theme-btn svg,
.white-noise-btn svg {
  display: block;
  margin: 0;
  padding: 0;
}

/* 设置弹窗蒙层 */
.settings-modal {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

/* 深色模式（默认）设置页 */
.settings-content {
  background: #23263a;
  color: #e0e6f0;
  border-radius: 10px;
  padding: 32px 24px 20px 24px;
  min-width: 300px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.32);
}
.setting-item {
  display: flex;
  align-items: center;
  margin-bottom: 18px;
}
.setting-item label {
  flex: 1;
  text-align: right;
  margin-right: 10px;
  color: #bfc9d4;
}
.setting-item input[type="number"] {
  width: 70px;
  padding: 4px 8px;
  font-size: 1em;
  border-radius: 4px;
  border: 1px solid #3a3f5a;
  background: #23263a;
  color: #e0e6f0;
}
.settings-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 18px;
}
.settings-actions button {
  padding: 6px 18px;
  font-size: 1em;
  border-radius: 6px;
  border: 1px solid #3a3f5a;
  background: #2f3241;
  color: #e0e6f0;
  cursor: pointer;
  transition: background 0.2s;
}
.settings-actions button:hover,
button:hover {
  background: #49507a;
  border-color: #6c7ae0;
  color: #fff;
}
button {
  margin: 0 8px;
  padding: 8px 20px;
  font-size: 1em;
  border-radius: 6px;
  border: 1px solid #3a3f5a;
  background: #2f3241;
  color: #e0e6f0;
  cursor: pointer;
  transition: background 0.2s;
}
button:disabled {
  background: #23263a;
  color: #555a6a;
  cursor: not-allowed;
}

/* 浅色模式设置页（body.light） */
body.light .settings-modal {
  background: rgba(0,0,0,0.12);
}
body.light .settings-content {
  background: #fff;
  color: #2f3241;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
}
body.light .setting-item label {
  color: #2f3241;
}
body.light .setting-item input[type="number"] {
  background: #fff;
  color: #2f3241;
  border: 1px solid #bbb;
}
body.light .settings-actions button {
  background: #f0f0f0;
  color: #2f3241;
  border: 1px solid #bbb;
}
body.light .settings-actions button:hover {
  background: #e0e0e0;
}
body.light button {
  background: #f0f0f0;
  color: #2f3241;
  border: 1px solid #bbb;
}
body.light button:disabled {
  background: #eee;
  color: #aaa;
}

.white-noise-modal {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
body.light .white-noise-modal {
  background: rgba(0,0,0,0.12);
}
.white-noise-content {
  background: #23263a;
  color: #e0e6f0;
  border-radius: 10px;
  padding: 32px 24px 20px 24px;
  min-width: 340px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.32);
}
body.light .white-noise-content {
  background: #fff;
  color: #2f3241;
  box-shadow: 0 4px 24px rgba(0,0,0,0.12);
}
.white-noise-list {
  display: flex;
  gap: 18px;
  margin: 15px 0 10px 0;
  flex-wrap: wrap;
  justify-content: center;
  max-height: 70vh;
  overflow-y: auto;
  padding-top: 8px;
  padding-bottom: 8px;
}
.white-noise-card {
  background: #2f3241;
  border-radius: 8px;
  padding: 18px 16px 12px 16px;
  min-width: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  cursor: pointer;
  transition: box-shadow 0.2s, background 0.2s;
  position: relative;
}
.white-noise-card.playing {
  box-shadow: 0 0 0 2px #6c7ae0;
  background: #49507a;
}
body.light .white-noise-card {
  background: #f0f0f0;
}
body.light .white-noise-card.playing {
  background: #e0e0e0;
  box-shadow: 0 0 0 2px #007acc;
}
.icon {
  margin: 12px 0 8px 0;
}
.label {
  font-size: 1.1em;
  margin-bottom: 8px;
}
input[type="range"] {
  width: 90px;
  margin-top: 6px;
}
.white-noise-actions {
  display: flex;
  justify-content: flex-end;
  margin-top: 16px;
}
.white-noise-actions button {
  padding: 6px 18px;
  font-size: 1em;
  border-radius: 6px;
  border: 1px solid #3a3f5a;
  background: #2f3241;
  color: #e0e6f0;
  cursor: pointer;
  transition: background 0.2s;
}
body.light .white-noise-actions button {
  background: #f0f0f0;
  color: #2f3241;
  border: 1px solid #bbb;
}
.white-noise-actions button:hover {
  background: #49507a;
  border-color: #6c7ae0;
  color: #fff;
}
body.light .white-noise-actions button:hover {
  background: #e0e0e0;
  color: #2f3241;
  border-color: #007acc;
}

.menu-fade-enter-active,
.menu-fade-leave-active {
  transition: opacity 0.3s, transform 0.3s;
}
.menu-fade-enter-from {
  opacity: 0;
  transform: translateY(40px);
}
.menu-fade-enter-to {
  opacity: 1;
  transform: translateY(0);
}
.menu-fade-leave-from {
  opacity: 1;
  transform: translateY(0);
}
.menu-fade-leave-to {
  opacity: 0;
  transform: translateY(40px);
}
</style>